{% extends 'panel/base.html' %}

{% block title %}Категории{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Категории</h1>
    <p>Управление категориями товаров</p>
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Добавить категорию</h3>
    </div>
    <form method="post" enctype="multipart/form-data" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: end;">
        {% csrf_token %}
        <input type="hidden" name="action" value="add">
        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 200px;">
            <label for="name">Название</label>
            <input type="text" name="name" id="name" class="form-control" required placeholder="Название категории">
        </div>
        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 200px;">
            <label for="description">Описание</label>
            <input type="text" name="description" id="description" class="form-control" placeholder="Краткое описание">
        </div>
        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 200px;">
            <label for="image">Изображение</label>
            <input type="file" name="image" id="image" class="form-control" accept="image/*">
        </div>
        <button type="submit" class="btn btn-primary">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            Добавить
        </button>
    </form>
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Все категории</h3>
    </div>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Название</th>
                    <th>Описание</th>
                    <th>Товаров</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                {% for cat in categories %}
                <tr>
                    <td><strong>{{ cat.name }}</strong></td>
                    <td>{{ cat.description|default:"-" }}</td>
                    <td>
                        <span class="badge badge-success">{{ cat.item_count }}</span>
                    </td>
                    <td>
                        <form method="post" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="category_id" value="{{ cat.id }}">
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Удалить категорию «{{ cat.name }}»? Все товары в этой категории также будут удалены!')">Удалить</button>
                        </form>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="text-align: center; padding: 40px; color: #6b7280;">
                        Категорий пока нет. Добавьте первую категорию выше.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
